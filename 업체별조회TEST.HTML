<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì—…ì²´ë³„ ì´ë ¥ì¡°íšŒ2 Â· ë°ì´í„°ë·°ì…‹ ì •ë ¬(ì˜¤ë¦„/ë‚´ë¦¼)</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<style>
  :root{
    --bg:#0f172a; --panel:#111827; --ink:#e5e7eb; --muted:#9ca3af; --brand:#60a5fa; --border:#1f2937;
    --good:#10b98133; --warn:#eab30833; --bad:#f8717137;
  }
  *{box-sizing:border-box}
  body{
    background:var(--bg); color:var(--ink);
    font-family: system-ui,-apple-system,Segoe UI,Roboto,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
    margin:0;
  }
  header{
    padding:16px 20px; border-bottom:1px solid var(--border);
    position:sticky; top:0; background:var(--bg); z-index:10;
  }
  header h1{margin:0 0 8px;font-size:18px;font-weight:700}
  .toolbar{
    display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  }
  .btn{
    background:#111827;border:1px solid var(--border);color:var(--ink);
    padding:8px 12px;border-radius:10px;cursor:pointer;
  }
  .btn:hover{border-color:#334155}
  .pill{
    padding:8px 12px;border-radius:999px;border:1px solid var(--border);
    background:#0b1226;color:var(--ink);
  }
  input[type="text"]{
    background:#0b1226;border:1px solid var(--border);color:var(--ink);
    padding:8px 12px;border-radius:10px;outline:none;min-width:220px;
  }
  main{padding:16px 20px}
  .tablewrap{
    border:1px solid var(--border); border-radius:14px; overflow:auto; background:var(--panel);
  }
  table{width:100%; border-collapse:collapse; font-size:14px}
  thead th{
    position:sticky; top:0; background:#0b1226; color:var(--ink);
    border-bottom:1px solid var(--border);
    padding:12px 10px; text-align:left; white-space:nowrap;
  }
  tbody td{
    border-top:1px solid var(--border);
    padding:10px; vertical-align:top;
  }
  th.sortable{ cursor:pointer; }
  th.sortable .arrow{ float:right; opacity:.9; }
  .muted{ color:var(--muted); }
  .badge{
    display:inline-block; padding:2px 8px; border-radius:999px;
    background:#0b1226; border:1px solid var(--border); font-size:12px;
  }
  .stats{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin:10px 0 14px; }
  .hint{ color:var(--muted); font-size:12px; margin-top:8px; }
  .count{ font-weight:600 }
</style>
</head>
<body>
<header>
  <h1>ì—…ì²´ë³„ ì´ë ¥ì¡°íšŒ2</h1>
  <div class="toolbar">
    <button class="btn" id="reloadBtn">ê¸°ë³¸ ì—‘ì…€ ë¡œë“œ(./data.xlsx)</button>
    <label class="btn" for="file">íŒŒì¼ ì„ íƒ</label>
    <input id="file" type="file" accept=".xlsx,.xls" style="display:none" />
    <input id="q" type="text" placeholder="ì „ì²´ ê²€ìƒ‰ (í”„ë¡œì íŠ¸ëª…/êµ¬ë§¤ì²˜ëª…/í’ˆëª©ëª… ë“±)" />
    <span class="pill"><span class="count" id="rowCount">0</span>ê±´</span>
  </div>
  <div class="hint">ì •ë ¬: í—¤ë” í´ë¦­ ì‹œ â–²(ì˜¤ë¦„)â†”â–¼(ë‚´ë¦¼) í† ê¸€ Â· ìˆ«ì/ë‚ ì§œ/ë¬¸ì ìë™ ì¸ì‹ Â· ë¹ˆê°’ì€ ì•„ë˜ë¡œ</div>
</header>

<main>
  <div class="stats" id="stats"></div>
  <div class="tablewrap">
    <table id="grid">
      <thead>
        <tr>
          <!-- data-keyëŠ” ê°ì²´ í‚¤ì™€ ì¼ì¹˜í•˜ë„ë¡ -->
          <th class="sortable" data-key="POìƒì„±ì¼">POìƒì„±ì¼ <span class="arrow"></span></th>
          <th class="sortable" data-key="í”„ë¡œì íŠ¸ëª…">í”„ë¡œì íŠ¸ëª… <span class="arrow"></span></th>
          <th class="sortable" data-key="êµ¬ë§¤ì²˜ëª…">êµ¬ë§¤ì²˜ëª… <span class="arrow"></span></th>
          <th class="sortable" data-key="í’ˆëª©ëª…">í’ˆëª©ëª… <span class="arrow"></span></th>
          <th class="sortable" data-key="ìˆ˜ëŸ‰">ìˆ˜ëŸ‰ <span class="arrow"></span></th>
          <th class="sortable" data-key="ì„œë¹„ìŠ¤ë‹¨ê°€">ì„œë¹„ìŠ¤ë‹¨ê°€ <span class="arrow"></span></th>
          <th class="sortable" data-key="ê¸ˆì•¡">ê¸ˆì•¡ <span class="arrow"></span></th>
          <th class="sortable" data-key="ë¹„ê³ ">ë¹„ê³  <span class="arrow"></span></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</main>

<script>
/* =========================
   0) ì „ì—­ ìƒíƒœ
========================= */
let RAW = [];          // ì›ë³¸ ë°°ì—´ [{POìƒì„±ì¼:..., í”„ë¡œì íŠ¸ëª…:..., ...}, ...]
let filtered = [];     // ê²€ìƒ‰/í•„í„° í›„ ë°°ì—´
let sortKey = null;    // í˜„ì¬ ì •ë ¬ í‚¤
let sortDir = 'asc';   // 'asc' | 'desc'

/* =========================
   1) ìœ í‹¸: ìˆ«ì/ë‚ ì§œ/ì •ë ¬
========================= */
function parseNumeric(v) {
  if (v == null) return NaN;
  if (typeof v === 'number') return v;
  const s = String(v).replace(/[^0-9.\-]/g, ''); // ìˆ«ì/ì†Œìˆ˜ì /ìŒìˆ˜ë§Œ
  return s ? Number(s) : NaN;
}

// Excel serial â†” Date(rough)
function parseDate(v) {
  if (v instanceof Date && !isNaN(v)) return v;
  if (typeof v === 'number' && v > 25569 && v < 80000) {
    const ms = Math.round((v - 25569) * 86400 * 1000);
    return new Date(ms);
  }
  const m = String(v).match(/^(\d{4})[./-](\d{1,2})[./-](\d{1,2})$/);
  if (m) return new Date(Number(m[1]), Number(m[2]) - 1, Number(m[3]));
  return null;
}

// ë¹ˆê°’ì€ í•­ìƒ ë’¤ë¡œ
function isEmpty(v){
  return v == null || v === '' || (typeof v === 'string' && v.trim() === '');
}

function baseCompare(a, b) {
  const ea = isEmpty(a), eb = isEmpty(b);
  if (ea && eb) return 0;
  if (ea) return 1;
  if (eb) return -1;

  const na = parseNumeric(a), nb = parseNumeric(b);
  if (Number.isFinite(na) && Number.isFinite(nb)) return na - nb;

  const da = parseDate(a), db = parseDate(b);
  if (da && db) return da - db;

  return String(a).localeCompare(String(b), 'ko', { numeric:true, sensitivity:'base' });
}

function applySort(rows){
  if (!sortKey) return rows;
  const dir = (sortDir === 'asc') ? 1 : -1;
  return [...rows].sort((ra, rb) => baseCompare(ra[sortKey], rb[sortKey]) * dir);
}

// í†µì¼ëœ í‘œì‹œ í¬ë§·(ì„ íƒ)
function fmtDate(v){
  const d = parseDate(v);
  if (!d) return (v ?? '');
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const dd = String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${dd}`;
}
function fmtMoney(v){
  const n = parseNumeric(v);
  if (!Number.isFinite(n)) return v ?? '';
  return n.toLocaleString('ko-KR') + 'ì›';
}

/* =========================
   2) ë Œë”
========================= */
const TBODY = document.querySelector('#grid tbody');
const COUNT = document.getElementById('rowCount');

function render(){
  // ê²€ìƒ‰ì–´ ë°˜ì˜
  const q = document.getElementById('q').value.trim().toLowerCase();
  filtered = RAW.filter(r => {
    if (!q) return true;
    // í”„ë¡œì íŠ¸ëª…/êµ¬ë§¤ì²˜ëª…/í’ˆëª©ëª…/ë¹„ê³  ëŒ€ìƒ
    return ['í”„ë¡œì íŠ¸ëª…','êµ¬ë§¤ì²˜ëª…','í’ˆëª©ëª…','ë¹„ê³ '].some(k=>{
      return String(r[k] ?? '').toLowerCase().includes(q);
    });
  });

  // ì •ë ¬ ì ìš©
  const rows = applySort(filtered);

  // ê·¸ë¦¬ë“œ ë Œë”
  TBODY.innerHTML = '';
  const frag = document.createDocumentFragment();
  for (const r of rows){
    const tr = document.createElement('tr');

    const td0 = document.createElement('td'); td0.textContent = fmtDate(r['POìƒì„±ì¼']);
    const td1 = document.createElement('td'); td1.textContent = r['í”„ë¡œì íŠ¸ëª…'] ?? '';
    const td2 = document.createElement('td'); td2.textContent = r['êµ¬ë§¤ì²˜ëª…'] ?? '';
    const td3 = document.createElement('td'); td3.textContent = r['í’ˆëª©ëª…'] ?? '';
    const td4 = document.createElement('td'); td4.textContent = Number.isFinite(parseNumeric(r['ìˆ˜ëŸ‰'])) ? parseNumeric(r['ìˆ˜ëŸ‰']).toLocaleString('ko-KR') : (r['ìˆ˜ëŸ‰'] ?? '');
    const td5 = document.createElement('td'); td5.textContent = fmtMoney(r['ì„œë¹„ìŠ¤ë‹¨ê°€']);
    const td6 = document.createElement('td'); td6.textContent = fmtMoney(r['ê¸ˆì•¡']);
    const td7 = document.createElement('td'); td7.textContent = r['ë¹„ê³ '] ?? '';

    tr.append(td0,td1,td2,td3,td4,td5,td6,td7);
    frag.appendChild(tr);
  }
  TBODY.appendChild(frag);
  COUNT.textContent = rows.length;

  paintHeaderArrows();
}

function paintHeaderArrows(){
  document.querySelectorAll('th.sortable').forEach(th=>{
    const key = th.dataset.key;
    const arrow = th.querySelector('.arrow');
    arrow.textContent = (key === sortKey) ? (sortDir === 'asc' ? 'â–²' : 'â–¼') : '';
  });
}

/* =========================
   3) ì´ë²¤íŠ¸: ì •ë ¬/ê²€ìƒ‰
========================= */
document.querySelectorAll('th.sortable').forEach(th=>{
  th.addEventListener('click', ()=>{
    const key = th.dataset.key;
    if (sortKey === key){
      sortDir = (sortDir === 'asc') ? 'desc' : 'asc';
    } else {
      sortKey = key;
      sortDir = 'asc'; // ì²« í´ë¦­ì€ ì˜¤ë¦„ì°¨ìˆœ
    }
    render();
  });
});

document.getElementById('q').addEventListener('input', ()=>{
  render();
});

/* =========================
   4) ë°ì´í„° ë¡œë“œ
========================= */
async function readWorkbook(file){
  const data = await file.arrayBuffer();
  const wb = XLSX.read(data, {type:'array'});
  // ìš°ì„  ì²« ë²ˆì§¸ ì‹œíŠ¸ ì‚¬ìš©
  const wsname = wb.SheetNames[0];
  const ws = wb.Sheets[wsname];
  const arr = XLSX.utils.sheet_to_json(ws, {defval:''});
  // ì»¬ëŸ¼ëª…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ, ì•„ë˜ í‚¤ê°€ ìˆìœ¼ë©´ ë§¤í•‘í•˜ê³  ì—†ìœ¼ë©´ ìœ ì¶”
  RAW = arr.map(row=>{
    return {
      'POìƒì„±ì¼': row['POìƒì„±ì¼'] ?? row['ë°œì£¼ì¼'] ?? row['ì…ë ¥ì¼ì'] ?? row['Date'] ?? row['ë‚ ì§œ'] ?? '',
      'í”„ë¡œì íŠ¸ëª…': row['í”„ë¡œì íŠ¸ëª…'] ?? row['í”„ë¡œì íŠ¸'] ?? row['Project'] ?? '',
      'êµ¬ë§¤ì²˜ëª…'  : row['êµ¬ë§¤ì²˜ëª…'] ?? row['ì—…ì²´ëª…'] ?? row['ê±°ë˜ì²˜'] ?? row['Supplier'] ?? '',
      'í’ˆëª©ëª…'    : row['í’ˆëª©ëª…'] ?? row['í•­ëª©'] ?? row['Item'] ?? '',
      'ìˆ˜ëŸ‰'      : row['ìˆ˜ëŸ‰'] ?? row['Qty'] ?? '',
      'ì„œë¹„ìŠ¤ë‹¨ê°€' : row['ì„œë¹„ìŠ¤ë‹¨ê°€'] ?? row['ë‹¨ê°€'] ?? row['UnitPrice'] ?? '',
      'ê¸ˆì•¡'      : row['ê¸ˆì•¡'] ?? row['í•©ê³„'] ?? row['Amount'] ?? '',
      'ë¹„ê³ '      : row['ë¹„ê³ '] ?? row['ë©”ëª¨'] ?? row['Remark'] ?? '',
    };
  });
  // ê¸°ë³¸ ì •ë ¬ í‚¤ ì„¤ì •(ì˜ˆ: POìƒì„±ì¼ ë‚´ë¦¼ì°¨ìˆœ)
  sortKey = 'POìƒì„±ì¼';
  sortDir = 'desc';
  render();
}

async function fetchXlsx(url){
  const res = await fetch(url);
  if (!res.ok) throw new Error('ì—‘ì…€ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: ' + res.status);
  const buf = await res.arrayBuffer();
  const wb = XLSX.read(buf, {type:'array'});
  const wsname = wb.SheetNames[0];
  const ws = wb.Sheets[wsname];
  const arr = XLSX.utils.sheet_to_json(ws, {defval:''});
  RAW = arr.map(row=>{
    return {
      'POìƒì„±ì¼': row['POìƒì„±ì¼'] ?? row['ë°œì£¼ì¼'] ?? row['ì…ë ¥ì¼ì'] ?? row['Date'] ?? row['ë‚ ì§œ'] ?? '',
      'í”„ë¡œì íŠ¸ëª…': row['í”„ë¡œì íŠ¸ëª…'] ?? row['í”„ë¡œì íŠ¸'] ?? row['Project'] ?? '',
      'êµ¬ë§¤ì²˜ëª…'  : row['êµ¬ë§¤ì²˜ëª…'] ?? row['ì—…ì²´ëª…'] ?? row['ê±°ë˜ì²˜'] ?? row['Supplier'] ?? '',
      'í’ˆëª©ëª…'    : row['í’ˆëª©ëª…'] ?? row['í•­ëª©'] ?? row['Item'] ?? '',
      'ìˆ˜ëŸ‰'      : row['ìˆ˜ëŸ‰'] ?? row['Qty'] ?? '',
      'ì„œë¹„ìŠ¤ë‹¨ê°€' : row['ì„œë¹„ìŠ¤ë‹¨ê°€'] ?? row['ë‹¨ê°€'] ?? row['UnitPrice'] ?? '',
      'ê¸ˆì•¡'      : row['ê¸ˆì•¡'] ?? row['í•©ê³„'] ?? row['Amount'] ?? '',
      'ë¹„ê³ '      : row['ë¹„ê³ '] ?? row['ë©”ëª¨'] ?? row['Remark'] ?? '',
    };
  });
  sortKey = 'POìƒì„±ì¼';
  sortDir = 'desc';
  render();
}

// íŒŒì¼ ì„ íƒ
document.getElementById('file').addEventListener('change', (e)=>{
  const file = e.target.files?.[0];
  if (file) readWorkbook(file);
});

// ê¸°ë³¸ ê²½ë¡œ ë¡œë“œ ë²„íŠ¼
document.getElementById('reloadBtn').addEventListener('click', ()=>{
  // ğŸ‘‰ í•„ìš” ì‹œ ì—¬ëŸ¬ë¶„ ì €ì¥ì†Œ ê²½ë¡œë¡œ ë³€ê²½
  fetchXlsx('./data.xlsx').catch(err=>{
    alert(err.message);
  });
});

/* =========================
   5) ë°ëª¨ ë°ì´í„°(ì„ íƒ)
   - data.xlsxê°€ ì—†ì„ ë•Œ í˜ì´ì§€ í™•ì¸ìš©
========================= */
function loadDemo(){
  RAW = [
    {POìƒì„±ì¼:'2025-09-01', í”„ë¡œì íŠ¸ëª…:'ì—ìŠ¤í… ì°¨ì„¸ëŒ€ ERP', êµ¬ë§¤ì²˜ëª…:'ë””ë¶€', í’ˆëª©ëª…:'ì»¨ì„¤íŒ…', ìˆ˜ëŸ‰:2, ì„œë¹„ìŠ¤ë‹¨ê°€:2000000, ê¸ˆì•¡:4000000, ë¹„ê³ :''},
    {POìƒì„±ì¼:45590,        í”„ë¡œì íŠ¸ëª…:'ë¬¸ì„œì¤‘ì•™í™”',       êµ¬ë§¤ì²˜ëª…:'í”Œë¡œìš°ì•„ì´í‹°', í’ˆëª©ëª…:'S/W ë¼ì´ì„ ìŠ¤', ìˆ˜ëŸ‰:10, ì„œë¹„ìŠ¤ë‹¨ê°€:'350,000ì›', ê¸ˆì•¡:'3,500,000ì›', ë¹„ê³ :'ê¸´ê¸‰'},
    {POìƒì„±ì¼:'2025-08-25', í”„ë¡œì íŠ¸ëª…:'ì‚¼ì„±ì›°ìŠ¤í† ë¦¬ EHS', êµ¬ë§¤ì²˜ëª…:'ë‹¨êµ°ì†Œí”„íŠ¸', í’ˆëª©ëª…:'AG-Grid Enterprise', ìˆ˜ëŸ‰:5, ì„œë¹„ìŠ¤ë‹¨ê°€:'1,200,000ì›', ê¸ˆì•¡:'6,000,000ì›', ë¹„ê³ :''},
    {POìƒì„±ì¼:'',           í”„ë¡œì íŠ¸ëª…:'SAP ê³ ë„í™”',       êµ¬ë§¤ì²˜ëª…:'ì½”ì˜¤ë¡±ë² ë‹ˆíŠ¸', í’ˆëª©ëª…:'ì™¸ì£¼ê°œë°œ', ìˆ˜ëŸ‰:1, ì„œë¹„ìŠ¤ë‹¨ê°€:10000000, ê¸ˆì•¡:10000000, ë¹„ê³ :'ë¹ˆ ë‚ ì§œ í…ŒìŠ¤íŠ¸'},
    {POìƒì„±ì¼:'2025/07/03', í”„ë¡œì íŠ¸ëª…:'AI ATLAS',         êµ¬ë§¤ì²˜ëª…:'ìœ ë¹„ì•¤í‹°ìŠ¤ë©', í’ˆëª©ëª…:'SSO ë¼ì´ì„ ìŠ¤', ìˆ˜ëŸ‰:3, ì„œë¹„ìŠ¤ë‹¨ê°€:'2,500,000ì›', ê¸ˆì•¡:'7,500,000ì›', ë¹„ê³ :'ê²€í† '},
  ];
  sortKey = 'POìƒì„±ì¼';
  sortDir = 'desc';
  render();
}

// ì´ˆê¸°: í•´ì‹œë¡œ xlsx ê²½ë¡œê°€ ì˜¤ë©´ ë¡œë“œ, ì•„ë‹ˆë©´ ë°ëª¨
(function init(){
  const hash = decodeURIComponent(location.hash || '').replace(/^#/, '');
  // ì˜ˆ) #https://raw.githubusercontent.com/.../data.xlsx
  if (hash.endsWith('.xlsx') || hash.endsWith('.xls')){
    fetchXlsx(hash).catch(err=>{
      console.warn(err);
      loadDemo();
    });
  }else{
    loadDemo();
  }
})();
</script>
</body>
</html>
